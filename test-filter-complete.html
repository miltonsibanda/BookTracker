<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✅ Filter Implementation Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .header { background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .filters { display: flex; gap: 15px; margin: 20px 0; flex-wrap: wrap; }
        select { padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; background: white; min-width: 150px; }
        .books-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin: 20px 0; }
        .book-card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; background: white; transition: all 0.2s; }
        .book-card.hidden { display: none; }
        .book-card:hover { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        .book-title { font-size: 18px; font-weight: bold; color: #1f2937; margin: 0 0 5px 0; }
        .book-author { color: #6b7280; margin: 0 0 10px 0; }
        .book-meta { display: flex; gap: 10px; flex-wrap: wrap; }
        .book-meta span { background: #f3f4f6; padding: 4px 8px; border-radius: 4px; font-size: 12px; color: #374151; }
        .status-read { background: #dcfce7; color: #16a34a; }
        .status-currently-reading { background: #dbeafe; color: #2563eb; }
        .status-want-to-read { background: #fef3c7; color: #d97706; }
        .status-dnf { background: #fee2e2; color: #dc2626; }
        .stats { background: #f9fafb; padding: 15px; border-radius: 6px; margin: 20px 0; }
        .debug-info { background: #1e293b; color: #e2e8f0; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 14px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="header">
        <h1>✅ Filter Implementation Test</h1>
        <p>Testing the exact same filter logic from the main BookTracker app to verify filter functionality works correctly.</p>
    </div>

    <div class="filters">
        <select id="statusFilter">
            <option value="">All Status</option>
            <option value="want-to-read">Want to Read</option>
            <option value="currently-reading">Currently Reading</option>
            <option value="read">Read</option>
            <option value="dnf">DNF</option>
        </select>
        
        <select id="genreFilter">
            <option value="">All Genres</option>
            <option value="fae">Fae</option>
            <option value="shifter">Shifter</option>
            <option value="vampire">Vampire</option>
            <option value="human">Human</option>
            <option value="werewolf">Werewolf</option>
            <option value="other">Other</option>
        </select>

        <select id="tropeFilter">
            <option value="">All Tropes</option>
            <option value="chosen-one">Chosen One</option>
            <option value="love-triangle">Love Triangle</option>
            <option value="enemies-to-lovers">Enemies to Lovers</option>
            <option value="friends-to-lovers">Friends to Lovers</option>
            <option value="slow-burn">Slow Burn</option>
            <option value="found-family">Found Family</option>
            <option value="forbidden-love">Forbidden Love</option>
            <option value="redemption-arc">Redemption Arc</option>
            <option value="morally-grey">Morally Grey</option>
            <option value="fake-relationship">Fake Relationship</option>
            <option value="second-chance">Second Chance</option>
            <option value="why-choose">Why Choose</option>
            <option value="other">Other</option>
        </select>
    </div>

    <div class="stats" id="filterStats">
        <strong>Filter Status:</strong> No filters applied - showing all books
    </div>

    <div class="books-container" id="booksContainer">
        <!-- Books will be rendered here -->
    </div>

    <div class="debug-info" id="debugInfo">
        Debug information will appear here...<br>
    </div>

    <script>
        // Test data that matches the structure from the main app
        const testBooks = [
            {
                id: '1',
                title: 'Shadow and Bone',
                author: 'Leigh Bardugo',
                status: 'read',
                mythicalElement: 'fae',
                trope: 'chosen-one',
                rating: 4.5
            },
            {
                id: '2',
                title: 'Fourth Wing',
                author: 'Rebecca Yarros',
                status: 'currently-reading',
                mythicalElement: 'vampire',
                trope: 'enemies-to-lovers',
                rating: 5
            },
            {
                id: '3',
                title: 'Hunt on Dark Waters',
                author: 'Katee Robert',
                status: 'want-to-read',
                mythicalElement: 'shifter',
                trope: 'slow-burn',
                rating: 0
            },
            {
                id: '4',
                title: 'The Seven Husbands of Evelyn Hugo',
                author: 'Taylor Jenkins Reid',
                status: 'read',
                mythicalElement: 'human',
                trope: 'found-family',
                rating: 5
            },
            {
                id: '5',
                title: 'House of Earth and Blood',
                author: 'Sarah J. Maas',
                status: 'dnf',
                mythicalElement: 'fae',
                trope: 'enemies-to-lovers',
                rating: 2
            },
            {
                id: '6',
                title: 'Red Queen',
                author: 'Victoria Aveyard',
                status: 'read',
                mythicalElement: 'other',
                trope: 'love-triangle',
                rating: 3.5
            },
            {
                id: '7',
                title: 'The Cruel Prince',
                author: 'Holly Black',
                status: 'currently-reading',
                mythicalElement: 'fae',
                trope: 'enemies-to-lovers',
                rating: 4
            },
            {
                id: '8',
                title: 'Six of Crows',
                author: 'Leigh Bardugo',
                status: 'want-to-read',
                mythicalElement: 'human',
                trope: 'morally-grey',
                rating: 0
            }
        ];

        let filteredBooks = [...testBooks];

        function debugLog(message) {
            const debugDiv = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugDiv.innerHTML += `[${timestamp}] ${message}<br>`;
            debugDiv.scrollTop = debugDiv.scrollHeight;
            console.log(message);
        }

        // Exact copy of applyFilters from the main app
        function applyFilters() {
            const statusFilter = document.getElementById('statusFilter')?.value;
            const genreFilter = document.getElementById('genreFilter')?.value;
            const tropeFilter = document.getElementById('tropeFilter')?.value;
            
            debugLog(`Applying filters: status="${statusFilter}", genre="${genreFilter}", trope="${tropeFilter}"`);
            
            filteredBooks = testBooks.filter(book => {
                const statusMatch = !statusFilter || book.status === statusFilter;
                const genreMatch = !genreFilter || book.mythicalElement === genreFilter;
                const tropeMatch = !tropeFilter || book.trope === tropeFilter;
                
                const matches = statusMatch && genreMatch && tropeMatch;
                
                if (book.id <= '3') { // Debug first few books
                    debugLog(`Book "${book.title}": status(${statusMatch}), genre(${genreMatch}), trope(${tropeMatch}) = ${matches}`);
                }
                
                return matches;
            });
            
            debugLog(`Filter result: ${filteredBooks.length} of ${testBooks.length} books match`);
        }

        function renderBooks() {
            const container = document.getElementById('booksContainer');
            
            container.innerHTML = testBooks.map(book => {
                const isVisible = filteredBooks.includes(book);
                return `
                    <div class="book-card ${!isVisible ? 'hidden' : ''}" data-id="${book.id}">
                        <h3 class="book-title">${book.title}</h3>
                        <p class="book-author">by ${book.author}</p>
                        <div class="book-meta">
                            <span class="status-${book.status}">${getStatusLabel(book.status)}</span>
                            <span>Genre: ${book.mythicalElement}</span>
                            <span>Trope: ${book.trope}</span>
                            ${book.rating > 0 ? `<span>Rating: ${book.rating}/5</span>` : '<span>No rating</span>'}
                        </div>
                    </div>
                `;
            }).join('');

            updateStats();
        }

        function updateStats() {
            const statsDiv = document.getElementById('filterStats');
            const statusFilter = document.getElementById('statusFilter')?.value;
            const genreFilter = document.getElementById('genreFilter')?.value;
            const tropeFilter = document.getElementById('tropeFilter')?.value;
            
            const activeFilters = [];
            if (statusFilter) activeFilters.push(`Status: ${getStatusLabel(statusFilter)}`);
            if (genreFilter) activeFilters.push(`Genre: ${genreFilter}`);
            if (tropeFilter) activeFilters.push(`Trope: ${tropeFilter}`);
            
            if (activeFilters.length === 0) {
                statsDiv.innerHTML = `<strong>Filter Status:</strong> No filters applied - showing all ${testBooks.length} books`;
            } else {
                statsDiv.innerHTML = `<strong>Filter Status:</strong> ${activeFilters.join(', ')} | Showing ${filteredBooks.length} of ${testBooks.length} books`;
            }
        }

        function getStatusLabel(status) {
            const labels = {
                'want-to-read': 'Want to Read',
                'currently-reading': 'Currently Reading',
                'read': 'Read',
                'dnf': 'DNF'
            };
            return labels[status] || status;
        }

        function handleFilterChange() {
            debugLog('Filter changed - applying filters and re-rendering');
            applyFilters();
            renderBooks();
        }

        // Exact copy of checkAndBind from the main app
        function checkAndBind(id, event, handler) {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener(event, handler);
                debugLog(`✅ Event bound: ${id}.${event}`);
            } else {
                debugLog(`❌ Element not found for binding: ${id}`);
            }
        }

        // Initialize the test
        function init() {
            debugLog('🚀 Initializing filter test...');
            
            // Bind events exactly like the main app
            checkAndBind('statusFilter', 'change', handleFilterChange);
            checkAndBind('genreFilter', 'change', handleFilterChange);
            checkAndBind('tropeFilter', 'change', handleFilterChange);
            
            // Initial render
            applyFilters();
            renderBooks();
            
            debugLog('✅ Initialization complete');
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
