<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookTracker Integration Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        #results { margin-top: 20px; }
        .result-item { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>BookTracker Integration Test</h1>
    
    <div class="test-section">
        <h2>API Integration Tests</h2>
        <button onclick="testOpenLibraryAPI()">Test Open Library API</button>
        <button onclick="testGoogleBooksAPI()">Test Google Books API</button>
        <button onclick="testBothAPIs()">Test Both APIs Together</button>
    </div>

    <div id="results"></div>

    <script src="openlibrary-integration.js"></script>
    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result-item ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            results.appendChild(div);
            console.log(message);
        }

        async function testOpenLibraryAPI() {
            log('Testing Open Library API...');
            try {
                const api = new OpenLibraryAPI();
                const books = await api.searchBooks('harry potter', 5);
                log(`✓ Open Library API working! Found ${books.length} books`, 'success');
                if (books.length > 0) {
                    log(`First result: "${books[0].title}" by ${books[0].author}`, 'success');
                }
            } catch (error) {
                log(`✗ Open Library API error: ${error.message}`, 'error');
            }
        }

        async function testGoogleBooksAPI() {
            log('Testing Google Books API...');
            try {
                const url = 'https://www.googleapis.com/books/v1/volumes?q=harry+potter&maxResults=5';
                const response = await fetch(url);
                const data = await response.json();
                const count = data.items ? data.items.length : 0;
                log(`✓ Google Books API working! Found ${count} books`, 'success');
                if (data.items && data.items.length > 0) {
                    const book = data.items[0];
                    const title = book.volumeInfo.title || 'Unknown';
                    const author = (book.volumeInfo.authors || ['Unknown']).join(', ');
                    log(`First result: "${title}" by ${author}`, 'success');
                }
            } catch (error) {
                log(`✗ Google Books API error: ${error.message}`, 'error');
            }
        }

        async function testBothAPIs() {
            log('Testing combined API search...');
            try {
                // Simulate what BookTracker does
                const [googleResults, openLibraryResults] = await Promise.allSettled([
                    testGoogleSearch('the hobbit'),
                    testOpenLibrarySearch('the hobbit')
                ]);

                let totalBooks = 0;
                if (googleResults.status === 'fulfilled') {
                    totalBooks += googleResults.value;
                    log(`✓ Google Books: ${googleResults.value} results`, 'success');
                }
                if (openLibraryResults.status === 'fulfilled') {
                    totalBooks += openLibraryResults.value;
                    log(`✓ Open Library: ${openLibraryResults.value} results`, 'success');
                }

                log(`✓ Combined search successful! Total: ${totalBooks} books from both APIs`, 'success');
            } catch (error) {
                log(`✗ Combined search error: ${error.message}`, 'error');
            }
        }

        async function testGoogleSearch(query) {
            const url = `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&maxResults=10`;
            const response = await fetch(url);
            const data = await response.json();
            return data.items ? data.items.length : 0;
        }

        async function testOpenLibrarySearch(query) {
            const api = new OpenLibraryAPI();
            const books = await api.searchBooks(query, 10);
            return books.length;
        }

        // Auto-run tests on page load
        window.addEventListener('DOMContentLoaded', () => {
            log('BookTracker Integration Test Started', 'info');
            setTimeout(testBothAPIs, 1000);
        });
    </script>
</body>
</html>
