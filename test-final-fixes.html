<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Fixes Test - BookTracker</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div style="padding: 20px;">
        <h1>BookTracker - Final Fixes Test</h1>
        
        <div style="margin: 20px 0;">
            <h2>Test Results</h2>
            <div id="testResults"></div>
        </div>

        <div style="margin: 20px 0;">
            <h2>Half Star Rating Test</h2>
            <div class="form-group">
                <label for="bookRating" class="form-label">Try clicking on star halves</label>
                <div class="rating-input">
                    <div class="half-stars" id="ratingStars">
                        <i class="fas fa-star star" data-rating="1" data-star="1"></i>
                        <i class="fas fa-star star" data-rating="2" data-star="2"></i>
                        <i class="fas fa-star star" data-rating="3" data-star="3"></i>
                        <i class="fas fa-star star" data-rating="4" data-star="4"></i>
                        <i class="fas fa-star star" data-rating="5" data-star="5"></i>
                    </div>
                    <span class="rating-display-text" id="ratingText">No rating</span>
                    <input type="hidden" id="bookRating" name="rating" value="0">
                </div>
            </div>
        </div>

        <div style="margin: 20px 0;">
            <h2>Sample Book Cards</h2>
            <div id="booksContainer" class="books-grid"></div>
        </div>
    </div>

    <script src="script.js"></script>
    <script>
        function addTestResult(name, status, message) {
            const results = document.getElementById('testResults');
            const statusColor = status === 'success' ? 'green' : status === 'error' ? 'red' : 'orange';
            results.innerHTML += `
                <div style="padding: 10px; margin: 5px 0; border: 2px solid ${statusColor}; border-radius: 5px;">
                    <strong style="color: ${statusColor};">${name}:</strong> ${message}
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', () => {
            // Test global BookTracker availability
            if (window.bookTracker) {
                addTestResult('BookTracker Instance', 'success', 'BookTracker is globally available');
                
                // Test helper methods
                if (typeof window.bookTracker.getPhysicalFeatures === 'function') {
                    addTestResult('Physical Features Helper', 'success', 'getPhysicalFeatures method exists');
                } else {
                    addTestResult('Physical Features Helper', 'error', 'getPhysicalFeatures method missing');
                }

                if (typeof window.bookTracker.isSpecialEdition === 'function') {
                    addTestResult('Special Edition Helper', 'success', 'isSpecialEdition method exists');
                } else {
                    addTestResult('Special Edition Helper', 'error', 'isSpecialEdition method missing');
                }

                // Test rating system
                if (window.bookTracker.setupRatingInputs) {
                    window.bookTracker.setupRatingInputs();
                    addTestResult('Half Star Rating Setup', 'success', 'Rating system initialized');
                } else {
                    addTestResult('Half Star Rating Setup', 'error', 'Rating setup failed');
                }

                // Create test books with physical features
                const testBooks = [
                    {
                        id: 'test1',
                        title: 'Test Book with Physical Features',
                        author: 'Test Author',
                        status: 'read',
                        rating: 4.5,
                        mythicalElement: 'fae',
                        digitallySigned: true,
                        sprayedEdges: true,
                        gifted: true
                    },
                    {
                        id: 'test2',
                        title: 'Regular Book',
                        author: 'Another Author',
                        status: 'currently-reading',
                        rating: 3.5,
                        mythicalElement: 'vampire',
                        gifted: false
                    }
                ];

                // Override filteredBooks for testing
                window.bookTracker.filteredBooks = testBooks;
                
                // Test rendering
                const container = document.getElementById('booksContainer');
                try {
                    window.bookTracker.renderGridView(container);
                    addTestResult('Grid View Rendering', 'success', 'Grid view rendered with test books');
                } catch (error) {
                    addTestResult('Grid View Rendering', 'error', `Rendering failed: ${error.message}`);
                }

                // Check if physical features are displayed
                setTimeout(() => {
                    const physicalFeatureElements = document.querySelectorAll('.book-card__physical-features');
                    if (physicalFeatureElements.length > 0) {
                        addTestResult('Physical Features Display', 'success', `Found ${physicalFeatureElements.length} books with physical features displayed`);
                    } else {
                        addTestResult('Physical Features Display', 'error', 'No physical features found in rendered books');
                    }

                    const giftedElements = document.querySelectorAll('.book-card__gifted');
                    if (giftedElements.length > 0) {
                        addTestResult('Gifted Status Display', 'success', `Found ${giftedElements.length} books with gifted status displayed`);
                    } else {
                        addTestResult('Gifted Status Display', 'error', 'No gifted status found in rendered books');
                    }

                    const halfStarElements = document.querySelectorAll('.star-half');
                    const ratingElements = document.querySelectorAll('.book-card__rating');
                    if (ratingElements.length > 0) {
                        addTestResult('Star Ratings Display', 'success', `Found ${ratingElements.length} rating elements`);
                    } else {
                        addTestResult('Star Ratings Display', 'error', 'No star ratings found');
                    }
                }, 100);

            } else {
                addTestResult('BookTracker Instance', 'error', 'BookTracker not available');
            }
        });
    </script>
</body>
</html>
