<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß Filter Debugging Console</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f8fafc; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .test-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .test-panel { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .test-panel h3 { margin-top: 0; color: #1f2937; }
        .filters { display: flex; gap: 10px; margin: 15px 0; flex-wrap: wrap; }
        select { padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; }
        .results { background: #f9fafb; padding: 15px; border-radius: 4px; margin: 15px 0; }
        .console { background: #1e293b; color: #e2e8f0; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
        .status { padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { background: #dcfce7; color: #16a34a; border: 1px solid #bbf7d0; }
        .error { background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; }
        .warning { background: #fef3c7; color: #d97706; border: 1px solid #fde68a; }
        .info { background: #dbeafe; color: #2563eb; border: 1px solid #bfdbfe; }
        button { padding: 10px 15px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #2563eb; }
        .book-count { font-weight: bold; color: #1f2937; }
        .filter-value { background: #f3f4f6; padding: 2px 6px; border-radius: 3px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Filter Debugging Console</h1>
            <p>This tool tests filter functionality and provides detailed debugging information to identify why filters aren't working in the main app.</p>
            <div class="status info">
                <strong>üìã Test Plan:</strong>
                <ol>
                    <li>Test filter elements detection</li>
                    <li>Test event binding</li>
                    <li>Test filter logic with sample data</li>
                    <li>Compare with main app behavior</li>
                </ol>
            </div>
        </div>

        <div class="test-panel">
            <h3>üß™ Filter Test Environment</h3>
            
            <div class="filters">
                <select id="statusFilter">
                    <option value="">All Status</option>
                    <option value="want-to-read">Want to Read</option>
                    <option value="currently-reading">Currently Reading</option>
                    <option value="read">Read</option>
                    <option value="dnf">DNF</option>
                </select>
                
                <select id="genreFilter">
                    <option value="">All Genres</option>
                    <option value="fae">Fae</option>
                    <option value="shifter">Shifter</option>
                    <option value="vampire">Vampire</option>
                    <option value="human">Human</option>
                    <option value="werewolf">Werewolf</option>
                    <option value="other">Other</option>
                </select>

                <select id="tropeFilter">
                    <option value="">All Tropes</option>
                    <option value="chosen-one">Chosen One</option>
                    <option value="love-triangle">Love Triangle</option>
                    <option value="enemies-to-lovers">Enemies to Lovers</option>
                    <option value="friends-to-lovers">Friends to Lovers</option>
                    <option value="slow-burn">Slow Burn</option>
                    <option value="found-family">Found Family</option>
                    <option value="forbidden-love">Forbidden Love</option>
                    <option value="redemption-arc">Redemption Arc</option>
                    <option value="morally-grey">Morally Grey</option>
                    <option value="fake-relationship">Fake Relationship</option>
                    <option value="second-chance">Second Chance</option>
                    <option value="why-choose">Why Choose</option>
                    <option value="other">Other</option>
                </select>
            </div>

            <div class="results">
                <div class="book-count" id="bookCount">Books: 8 total, 8 visible</div>
                <div id="filterStatus">No filters applied</div>
            </div>

            <button onclick="runDiagnostics()">üîç Run Full Diagnostics</button>
            <button onclick="testMainApp()">üåê Open Main App</button>
            <button onclick="clearConsole()">üóëÔ∏è Clear Console</button>
        </div>

        <div class="test-panel">
            <h3>üìä Diagnostic Results</h3>
            <div id="diagnostics" class="status info">
                Click "Run Full Diagnostics" to start testing...
            </div>
        </div>

        <div class="test-panel" style="grid-column: 1 / -1;">
            <h3>üñ•Ô∏è Console Output</h3>
            <div id="console" class="console">
                Debugging console ready...<br>
            </div>
        </div>
    </div>

    <script>
        // Test data
        const testBooks = [
            { id: '1', title: 'Shadow and Bone', author: 'Leigh Bardugo', status: 'read', mythicalElement: 'fae', trope: 'chosen-one' },
            { id: '2', title: 'Fourth Wing', author: 'Rebecca Yarros', status: 'currently-reading', mythicalElement: 'vampire', trope: 'enemies-to-lovers' },
            { id: '3', title: 'Hunt on Dark Waters', author: 'Katee Robert', status: 'want-to-read', mythicalElement: 'shifter', trope: 'slow-burn' },
            { id: '4', title: 'The Seven Husbands of Evelyn Hugo', author: 'Taylor Jenkins Reid', status: 'read', mythicalElement: 'human', trope: 'found-family' },
            { id: '5', title: 'House of Earth and Blood', author: 'Sarah J. Maas', status: 'dnf', mythicalElement: 'fae', trope: 'enemies-to-lovers' },
            { id: '6', title: 'Red Queen', author: 'Victoria Aveyard', status: 'read', mythicalElement: 'other', trope: 'love-triangle' },
            { id: '7', title: 'The Cruel Prince', author: 'Holly Black', status: 'currently-reading', mythicalElement: 'fae', trope: 'enemies-to-lovers' },
            { id: '8', title: 'Six of Crows', author: 'Leigh Bardugo', status: 'want-to-read', mythicalElement: 'human', trope: 'morally-grey' }
        ];

        let filteredBooks = [...testBooks];

        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            console.innerHTML += `<span style="color: #64748b;">[${timestamp}]</span> ${message}<br>`;
            console.scrollTop = console.scrollHeight;
            window.console.log(message);
        }

        function clearConsole() {
            document.getElementById('console').innerHTML = 'Console cleared...<br>';
        }

        function testMainApp() {
            window.open('index.html', '_blank');
            log('üåê Opened main app in new tab');
        }

        function applyFilters() {
            const statusFilter = document.getElementById('statusFilter')?.value;
            const genreFilter = document.getElementById('genreFilter')?.value;
            const tropeFilter = document.getElementById('tropeFilter')?.value;
            
            log(`üîç Applying filters: status="${statusFilter}", genre="${genreFilter}", trope="${tropeFilter}"`);
            
            filteredBooks = testBooks.filter(book => {
                const statusMatch = !statusFilter || book.status === statusFilter;
                const genreMatch = !genreFilter || book.mythicalElement === genreFilter;
                const tropeMatch = !tropeFilter || book.trope === tropeFilter;
                
                return statusMatch && genreMatch && tropeMatch;
            });
            
            log(`üìä Filter result: ${filteredBooks.length} of ${testBooks.length} books match`);
            updateDisplay();
        }

        function updateDisplay() {
            const statusFilter = document.getElementById('statusFilter')?.value;
            const genreFilter = document.getElementById('genreFilter')?.value;
            const tropeFilter = document.getElementById('tropeFilter')?.value;
            
            document.getElementById('bookCount').innerHTML = `Books: ${testBooks.length} total, <span style="color: #059669;">${filteredBooks.length} visible</span>`;
            
            const activeFilters = [];
            if (statusFilter) activeFilters.push(`Status: <span class="filter-value">${statusFilter}</span>`);
            if (genreFilter) activeFilters.push(`Genre: <span class="filter-value">${genreFilter}</span>`);
            if (tropeFilter) activeFilters.push(`Trope: <span class="filter-value">${tropeFilter}</span>`);
            
            if (activeFilters.length === 0) {
                document.getElementById('filterStatus').innerHTML = 'No filters applied';
            } else {
                document.getElementById('filterStatus').innerHTML = `Active filters: ${activeFilters.join(', ')}`;
            }
        }

        function runDiagnostics() {
            const diagnostics = document.getElementById('diagnostics');
            let results = '<h4>üîç Element Detection Test</h4>';
            
            log('üöÄ Running full diagnostics...');
            
            // Test 1: Element detection
            const elements = ['statusFilter', 'genreFilter', 'tropeFilter'];
            let elementsFound = 0;
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    elementsFound++;
                    results += `<div class="status success">‚úÖ ${id}: Found (value: "${element.value}")</div>`;
                    log(`‚úÖ Element found: ${id}`);
                } else {
                    results += `<div class="status error">‚ùå ${id}: NOT FOUND</div>`;
                    log(`‚ùå Element missing: ${id}`);
                }
            });

            // Test 2: Event binding test
            results += '<h4>üéØ Event Binding Test</h4>';
            let eventsWorking = 0;
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    // Test if we can bind and trigger an event
                    let eventFired = false;
                    const testHandler = () => { eventFired = true; };
                    
                    element.addEventListener('change', testHandler);
                    
                    // Simulate event
                    const event = new Event('change');
                    element.dispatchEvent(event);
                    
                    if (eventFired) {
                        eventsWorking++;
                        results += `<div class="status success">‚úÖ ${id}: Event binding works</div>`;
                        log(`‚úÖ Event test passed: ${id}`);
                    } else {
                        results += `<div class="status error">‚ùå ${id}: Event binding failed</div>`;
                        log(`‚ùå Event test failed: ${id}`);
                    }
                    
                    element.removeEventListener('change', testHandler);
                }
            });

            // Test 3: Filter logic test
            results += '<h4>üßÆ Filter Logic Test</h4>';
            
            // Test with different filter combinations
            const testCases = [
                { status: '', genre: '', trope: '', expected: 8 },
                { status: 'read', genre: '', trope: '', expected: 3 },
                { status: '', genre: 'fae', trope: '', expected: 3 },
                { status: '', genre: '', trope: 'enemies-to-lovers', expected: 3 },
                { status: 'read', genre: 'fae', trope: '', expected: 1 },
                { status: 'read', genre: 'fae', trope: 'chosen-one', expected: 1 }
            ];
            
            let logicTestsPassed = 0;
            
            testCases.forEach((testCase, index) => {
                const filtered = testBooks.filter(book => {
                    const statusMatch = !testCase.status || book.status === testCase.status;
                    const genreMatch = !testCase.genre || book.mythicalElement === testCase.genre;
                    const tropeMatch = !testCase.trope || book.trope === testCase.trope;
                    return statusMatch && genreMatch && tropeMatch;
                });
                
                if (filtered.length === testCase.expected) {
                    logicTestsPassed++;
                    results += `<div class="status success">‚úÖ Test ${index + 1}: Expected ${testCase.expected}, got ${filtered.length}</div>`;
                    log(`‚úÖ Logic test ${index + 1} passed`);
                } else {
                    results += `<div class="status error">‚ùå Test ${index + 1}: Expected ${testCase.expected}, got ${filtered.length}</div>`;
                    log(`‚ùå Logic test ${index + 1} failed`);
                }
            });

            // Summary
            results += '<h4>üìã Summary</h4>';
            
            if (elementsFound === 3 && eventsWorking === 3 && logicTestsPassed === testCases.length) {
                results += '<div class="status success"><strong>‚úÖ All tests passed!</strong> The filter system should be working correctly.</div>';
                results += '<div class="status info">If filters aren\'t working in the main app, the issue might be:<ul><li>Timing issues with DOM loading</li><li>CSS hiding filtered elements incorrectly</li><li>Duplicate element IDs</li><li>Event handler conflicts</li></ul></div>';
                log('üéâ All diagnostic tests passed!');
            } else {
                results += '<div class="status error"><strong>‚ùå Some tests failed!</strong> This indicates there are issues with the filter implementation.</div>';
                log('‚ö†Ô∏è Diagnostic tests found issues');
            }

            diagnostics.innerHTML = results;
            log('‚úÖ Diagnostics complete');
        }

        // Set up event listeners
        function init() {
            log('üöÄ Initializing filter debug console...');
            
            ['statusFilter', 'genreFilter', 'tropeFilter'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('change', (e) => {
                        log(`üìù ${id} changed to: "${e.target.value}"`);
                        applyFilters();
                    });
                    log(`‚úÖ Event listener added: ${id}`);
                }
            });
            
            updateDisplay();
            log('‚úÖ Initialization complete');
        }

        // Initialize when ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>
