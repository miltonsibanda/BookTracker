<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DOM Filter Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .status { padding: 10px; margin: 5px 0; border-radius: 4px; }
        .status.success { background: #d1fae5; color: #065f46; }
        .status.error { background: #fee2e2; color: #991b1b; }
        .status.warning { background: #fef3c7; color: #92400e; }
        .status.info { background: #dbeafe; color: #1e40af; }
        pre { background: #f8fafc; padding: 10px; border-radius: 4px; overflow-x: auto; }
        button { padding: 10px 15px; margin: 5px; background: #3b82f6; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #2563eb; }
    </style>
</head>
<body>
    <h1>üîç DOM Filter Elements Debug Tool</h1>
    
    <div class="debug-section">
        <h2>1. Basic Element Detection</h2>
        <button onclick="checkBasicElements()">Check Filter Elements</button>
        <div id="basicResults"></div>
    </div>
    
    <div class="debug-section">
        <h2>2. Duplicate ID Detection</h2>
        <button onclick="checkDuplicateIds()">Check for Duplicate IDs</button>
        <div id="duplicateResults"></div>
    </div>
    
    <div class="debug-section">
        <h2>3. DOM Query Analysis</h2>
        <button onclick="analyzeQueries()">Analyze DOM Queries</button>
        <div id="queryResults"></div>
    </div>
    
    <div class="debug-section">
        <h2>4. Event Listener Test</h2>
        <button onclick="testEventListeners()">Test Event Binding</button>
        <div id="eventResults"></div>
    </div>

    <div class="debug-section">
        <h2>5. Open Main App</h2>
        <p>To test the main application:</p>
        <ol>
            <li>Open <a href="index.html" target="_blank">index.html</a> in a new tab</li>
            <li>Open browser console (F12)</li>
            <li>Try changing filter values</li>
            <li>Look for debug messages starting with "[DEBUG]"</li>
        </ol>
    </div>

    <script>
        function log(message, type = 'info') {
            const statusClass = type;
            return `<div class="status ${statusClass}"><strong>[${new Date().toLocaleTimeString()}]</strong> ${message}</div>`;
        }

        function checkBasicElements() {
            const results = document.getElementById('basicResults');
            let output = '';
            
            const filterIds = ['statusFilter', 'genreFilter', 'tropeFilter'];
            
            output += log('Checking filter elements...', 'info');
            
            filterIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    output += log(`‚úÖ ${id}: Found`, 'success');
                    output += log(`   Tag: ${element.tagName}`, 'info');
                    output += log(`   Class: ${element.className}`, 'info');
                    output += log(`   Options: ${element.options ? element.options.length : 'N/A'}`, 'info');
                } else {
                    output += log(`‚ùå ${id}: NOT FOUND`, 'error');
                }
            });
            
            results.innerHTML = output;
        }

        function checkDuplicateIds() {
            const results = document.getElementById('duplicateResults');
            let output = '';
            
            const filterIds = ['statusFilter', 'genreFilter', 'tropeFilter'];
            
            output += log('Checking for duplicate IDs...', 'info');
            
            filterIds.forEach(id => {
                const elements = document.querySelectorAll('#' + id);
                if (elements.length > 1) {
                    output += log(`‚ö†Ô∏è ${id}: ${elements.length} elements found (DUPLICATE!)`, 'error');
                    elements.forEach((el, index) => {
                        output += log(`   Element ${index + 1}: ${el.tagName} in ${el.parentElement.tagName}`, 'warning');
                    });
                } else if (elements.length === 1) {
                    output += log(`‚úÖ ${id}: Single element found`, 'success');
                } else {
                    output += log(`‚ùå ${id}: No elements found`, 'error');
                }
            });
            
            results.innerHTML = output;
        }

        function analyzeQueries() {
            const results = document.getElementById('queryResults');
            let output = '';
            
            output += log('Analyzing DOM query methods...', 'info');
            
            const filterIds = ['statusFilter', 'genreFilter', 'tropeFilter'];
            
            filterIds.forEach(id => {
                output += log(`--- Analyzing ${id} ---`, 'info');
                
                // Method 1: getElementById
                const byId = document.getElementById(id);
                output += log(`getElementById: ${byId ? '‚úÖ Found' : '‚ùå Not found'}`, byId ? 'success' : 'error');
                
                // Method 2: querySelector
                const byQuery = document.querySelector('#' + id);
                output += log(`querySelector: ${byQuery ? '‚úÖ Found' : '‚ùå Not found'}`, byQuery ? 'success' : 'error');
                
                // Method 3: querySelectorAll count
                const byQueryAll = document.querySelectorAll('#' + id);
                output += log(`querySelectorAll: ${byQueryAll.length} elements`, byQueryAll.length === 1 ? 'success' : byQueryAll.length > 1 ? 'warning' : 'error');
                
                if (byId) {
                    output += log(`   Parent: ${byId.parentElement.tagName}`, 'info');
                    output += log(`   Closest form: ${byId.closest('form') ? 'Found' : 'Not found'}`, 'info');
                }
            });
            
            results.innerHTML = output;
        }

        function testEventListeners() {
            const results = document.getElementById('eventResults');
            let output = '';
            
            output += log('Testing event listener binding...', 'info');
            
            const filterIds = ['statusFilter', 'genreFilter', 'tropeFilter'];
            
            // Create test elements similar to main app
            const testContainer = document.createElement('div');
            testContainer.innerHTML = `
                <select id="test_statusFilter">
                    <option value="">All Status</option>
                    <option value="read">Read</option>
                </select>
                <select id="test_genreFilter">
                    <option value="">All Genres</option>
                    <option value="fae">Fae</option>
                </select>
                <select id="test_tropeFilter">
                    <option value="">All Tropes</option>
                    <option value="enemies-to-lovers">Enemies to Lovers</option>
                </select>
            `;
            document.body.appendChild(testContainer);
            
            const checkAndBind = (id, event, handler) => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener(event, handler);
                    output += log(`‚úÖ Event bound to ${id}`, 'success');
                    return true;
                } else {
                    output += log(`‚ùå Element ${id} not found for binding`, 'error');
                    return false;
                }
            };
            
            // Test binding to our test elements
            checkAndBind('test_statusFilter', 'change', () => {
                output += log('üéØ test_statusFilter event fired!', 'success');
                results.innerHTML = results.innerHTML.replace('</div>', '') + log('üéØ test_statusFilter event fired!', 'success');
            });
            
            checkAndBind('test_genreFilter', 'change', () => {
                output += log('üéØ test_genreFilter event fired!', 'success');
                results.innerHTML = results.innerHTML.replace('</div>', '') + log('üéØ test_genreFilter event fired!', 'success');
            });
            
            checkAndBind('test_tropeFilter', 'change', () => {
                output += log('üéØ test_tropeFilter event fired!', 'success');
                results.innerHTML = results.innerHTML.replace('</div>', '') + log('üéØ test_tropeFilter event fired!', 'success');
            });
            
            output += log('Test elements created below (try changing them):', 'info');
            output += `<div style="margin: 10px 0; padding: 10px; background: #f8fafc; border-radius: 4px;">${testContainer.innerHTML}</div>`;
            
            results.innerHTML = output;
        }

        // Auto-run basic check on load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ DOM Debug tool loaded');
            checkBasicElements();
        });
    </script>
</body>
</html>
